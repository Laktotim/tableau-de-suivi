<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi des Activités</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            color: #333;
        }

        table {
            width: 80%;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
            transition: transform 0.3s;
        }

        table:hover {
            transform: scale(1.02);
        }

        th,
        td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            text-align: center;
            font-size: 1em;
        }

        th {
            background-color: #4CAF50;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            background-color: #f9f9f9;
        }

        tr:hover td {
            background-color: #f1f1f1;
        }

        input[type="checkbox"] {
            transform: scale(1.3);
            margin-right: 10px;
        }

        input[type="number"] {
            width: 60px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            border-color: #4CAF50;
            outline: none;
        }

        #timeo-total,
        #elise-total {
            font-weight: bold;
            text-align: center;
            font-size: 1.2em;
            color: #4CAF50;
        }
    </style>
</head>

<body>

    <h1>Tableau de Suivi</h1>

    <table>
        <thead>
            <tr>
                <th>Catégorie</th>
                <th>Timéo</th>
                <th>Elise</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Sport</td>
                <td>
                    <input type="checkbox" class="timeo-checkbox"> Séance 1<br>
                    <input type="checkbox" class="timeo-checkbox"> Séance 2<br>
                    <input type="checkbox" class="timeo-checkbox"> Séance 3
                </td>
                <td>
                    <input type="checkbox" class="elise-checkbox"> Séance 1<br>
                    <input type="checkbox" class="elise-checkbox"> Séance 2<br>
                    <input type="checkbox" class="elise-checkbox"> Séance 3
                </td>
            </tr>
            <tr>
                <td>Révision</td>
                <td>
                    <input type="checkbox" class="timeo-checkbox"> 1 heure<br>
                    <input type="checkbox" class="timeo-checkbox"> 2 heures<br>
                    <input type="checkbox" class="timeo-checkbox"> 3 heures
                </td>
                <td>
                    <input type="checkbox" class="elise-checkbox"> 1 heure<br>
                    <input type="checkbox" class="elise-checkbox"> 2 heures<br>
                    <input type="checkbox" class="elise-checkbox"> 3 heures
                </td>
            </tr>
            <tr>
                <td>Lecture</td>
                <td>
                    <input type="checkbox" class="timeo-checkbox"> 1 heure<br>
                    <input type="checkbox" class="timeo-checkbox"> 2 heures
                </td>
                <td>
                    <input type="checkbox" class="elise-checkbox"> 1 heure<br>
                    <input type="checkbox" class="elise-checkbox"> 2 heures
                </td>
            </tr>
            <tr>
                <td>Temps d'écran</td>
                <td>
                    Lundi: <input type="number" class="timeo-screen" min="0" max="24">h<br>
                    Mardi: <input type="number" class="timeo-screen" min="0" max="24">h<br>
                    Mercredi: <input type="number" class="timeo-screen" min="0" max="24">h<br>
                    Jeudi: <input type="number" class="timeo-screen" min="0" max="24">h<br>
                    Vendredi: <input type="number" class="timeo-screen" min="0" max="24">h<br>
                    Samedi: <input type="number" class="timeo-screen" min="0" max="24">h<br>
                    Dimanche: <input type="number" class="timeo-screen" min="0" max="24">h
                </td>
                <td>
                    Lundi: <input type="number" class="elise-screen" min="0" max="24">h<br>
                    Mardi: <input type="number" class="elise-screen" min="0" max="24">h<br>
                    Mercredi: <input type="number" class="elise-screen" min="0" max="24">h<br>
                    Jeudi: <input type="number" class="elise-screen" min="0" max="24">h<br>
                    Vendredi: <input type="number" class="elise-screen" min="0" max="24">h<br>
                    Samedi: <input type="number" class="elise-screen" min="0" max="24">h<br>
                    Dimanche: <input type="number" class="elise-screen" min="0" max="24">h
                </td>
            </tr>
            <tr>
                <td>8 heures de sommeil</td>
                <td>
                    Lundi: <input type="checkbox" class="timeo-sleep"><br>
                    Mardi: <input type="checkbox" class="timeo-sleep"><br>
                    Mercredi: <input type="checkbox" class="timeo-sleep"><br>
                    Jeudi: <input type="checkbox" class="timeo-sleep"><br>
                    Vendredi: <input type="checkbox" class="timeo-sleep"><br>
                    Samedi: <input type="checkbox" class="timeo-sleep"><br>
                    Dimanche: <input type="checkbox" class="timeo-sleep">
                </td>
                <td>
                    Lundi: <input type="checkbox" class="elise-sleep"><br>
                    Mardi: <input type="checkbox" class="elise-sleep"><br>
                    Mercredi: <input type="checkbox" class="elise-sleep"><br>
                    Jeudi: <input type="checkbox" class="elise-sleep"><br>
                    Vendredi: <input type="checkbox" class="elise-sleep"><br>
                    Samedi: <input type="checkbox" class="elise-sleep"><br>
                    Dimanche: <input type="checkbox" class="elise-sleep">
                </td>
            </tr>
            <tr>
                <td>Rangement</td>
                <td>
                    <input type="checkbox" class="timeo-checkbox"> Chambre rangée à la fin de la semaine
                </td>
                <td>
                    <input type="checkbox" class="elise-checkbox"> Chambre rangée à la fin de la semaine
                </td>
            </tr>
            <tr>
                <td>Total des Points</td>
                <td id="timeo-total">0</td>
                <td id="elise-total">0</td>
            </tr>
        </tbody>
    </table>

    <!-- Importer Firebase et Firestore -->
    <script type="module">
        // Importer les fonctions nécessaires de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js";
        import { getFirestore, collection, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        // Configuration de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAyS0lH351j7E1KgrNfjbfzpXQKXQEdJK8",
            authDomain: "nomduprojet.firebaseapp.com",
            projectId: "nomduprojet",
            storageBucket: "nomduprojet.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abcdef123456",
            measurementId: "G-ABCDEFG123"
        };

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', async () => {
            const timeoCheckboxes = document.querySelectorAll(".timeo-checkbox");
            const eliseCheckboxes = document.querySelectorAll(".elise-checkbox");
            const timeoScreenInputs = document.querySelectorAll(".timeo-screen");
            const eliseScreenInputs = document.querySelectorAll(".elise-screen");
            const timeoSleepCheckboxes = document.querySelectorAll(".timeo-sleep");
            const eliseSleepCheckboxes = document.querySelectorAll(".elise-sleep");
            const timeoTotal = document.getElementById("timeo-total");
            const eliseTotal = document.getElementById("elise-total");

            // Charger les données depuis Firestore
            async function loadFromFirestore() {
                try {
                    const docRef = doc(db, "activities", "summary");
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        timeoCheckboxes.forEach((checkbox, index) => {
                            checkbox.checked = data[`timeo-checkbox-${index}`] || false;
                        });
                        eliseCheckboxes.forEach((checkbox, index) => {
                            checkbox.checked = data[`elise-checkbox-${index}`] || false;
                        });
                        timeoScreenInputs.forEach((input, index) => {
                            input.value = data[`timeo-screen-${index}`] || "";
                        });
                        eliseScreenInputs.forEach((input, index) => {
                            input.value = data[`elise-screen-${index}`] || "";
                        });
                        timeoSleepCheckboxes.forEach((checkbox, index) => {
                            checkbox.checked = data[`timeo-sleep-${index}`] || false;
                        });
                        eliseSleepCheckboxes.forEach((checkbox, index) => {
                            checkbox.checked = data[`elise-sleep-${index}`] || false;
                        });
                    } else {
                        console.log("No such document!");
                    }
                } catch (error) {
                    console.error("Error loading data from Firestore: ", error);
                }
            }

            // Sauvegarder les données dans Firestore
            async function saveToFirestore() {
                try {
                    const data = {
                        ...Array.from(timeoCheckboxes).reduce((acc, checkbox, index) => {
                            acc[`timeo-checkbox-${index}`] = checkbox.checked;
                            return acc;
                        }, {}),
                        ...Array.from(eliseCheckboxes).reduce((acc, checkbox, index) => {
                            acc[`elise-checkbox-${index}`] = checkbox.checked;
                            return acc;
                        }, {}),
                        ...Array.from(timeoScreenInputs).reduce((acc, input, index) => {
                            acc[`timeo-screen-${index}`] = input.value;
                            return acc;
                        }, {}),
                        ...Array.from(eliseScreenInputs).reduce((acc, input, index) => {
                            acc[`elise-screen-${index}`] = input.value;
                            return acc;
                        }, {}),
                        ...Array.from(timeoSleepCheckboxes).reduce((acc, checkbox, index) => {
                            acc[`timeo-sleep-${index}`] = checkbox.checked;
                            return acc;
                        }, {}),
                        ...Array.from(eliseSleepCheckboxes).reduce((acc, checkbox, index) => {
                            acc[`elise-sleep-${index}`] = checkbox.checked;
                            return acc;
                        }, {}),
                    };

                    const docRef = doc(db, "activities", "summary");
                    await setDoc(docRef, data);
                } catch (error) {
                    console.error("Error saving data to Firestore: ", error);
                }
            }

            // Mettre à jour les points
            function updatePoints() {
                let timeoPoints = 0;
                let elisePoints = 0;

                // Points pour les cases à cocher de Timéo
                timeoCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        timeoPoints += 1;
                    }
                });

                // Points pour les cases à cocher d'Elise
                eliseCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        elisePoints += 1;
                    }
                });

                // Points pour le temps d'écran de Timéo
                timeoScreenInputs.forEach(input => {
                    const hours = parseInt(input.value, 10) || 0;
                    if (hours === 1) {
                        timeoPoints += 2;
                    } else if (hours === 2) {
                        timeoPoints += 1;
                    } else if (hours > 3) {
                        timeoPoints -= (hours - 3);
                    }
                });

                // Points pour le temps d'écran d'Elise
                eliseScreenInputs.forEach(input => {
                    const hours = parseInt(input.value, 10) || 0;
                    if (hours === 1) {
                        elisePoints += 2;
                    } else if (hours === 2) {
                        elisePoints += 1;
                    } else if (hours > 3) {
                        elisePoints -= (hours - 3);
                    }
                });

                // Points pour le sommeil de Timéo
                timeoSleepCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        timeoPoints += 1;
                    }
                });

                // Points pour le sommeil d'Elise
                eliseSleepCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        elisePoints += 1;
                    }
                });

                timeoTotal.textContent = timeoPoints;
                eliseTotal.textContent = elisePoints;
                saveToFirestore(); // Sauvegarder les points après mise à jour
            }

            // Initialisation
            await loadFromFirestore(); // Charger les données au démarrage
            updatePoints();

            timeoCheckboxes.forEach(checkbox => {
                checkbox.addEventListener("change", updatePoints);
            });

            eliseCheckboxes.forEach(checkbox => {
                checkbox.addEventListener("change", updatePoints);
            });

            timeoScreenInputs.forEach(input => {
                input.addEventListener("input", updatePoints);
            });

            eliseScreenInputs.forEach(input => {
                input.addEventListener("input", updatePoints);
            });

            timeoSleepCheckboxes.forEach(checkbox => {
                checkbox.addEventListener("change", updatePoints);
            });

            eliseSleepCheckboxes.forEach(checkbox => {
                checkbox.addEventListener("change", updatePoints);
            });
        });
    </script>
</body>

</html>
